<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Meus favoritos - Guia BH & Região</title>
<link rel="stylesheet" href="assets/css/styles.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
  .favoritos-hero {
    background: linear-gradient(135deg, #2a3b29 100%);
    color: rgb(248, 248, 248);
    padding: 3rem 0;
  }
  .card-favorito {
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .card-favorito:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  }
  .btn-remover {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
  }
  .empty-state {
    padding: 4rem 2rem;
    text-align: center;
  }
  .empty-state i {
    font-size: 5rem;
    color: #ccc;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>

<header class="bg-dark text-white py-3">
  <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
    <h1 class="logo mb-3 mb-md-0">Guia BH & Região</h1>
    <nav class="nav" id="main-nav">
      <a class="nav-link text-white" href="index.html">Home</a>
      <a class="nav-link text-white" href="cadastro.html">Cadastrar Local</a>
      <a class="nav-link text-white" href="melhores-avaliados.html">Melhores avaliados</a>
      <a class="nav-link text-white" href="#contato">Contato</a>
      <a class="nav-link text-white active" href="favoritos.html">Ver favoritos</a>
      <span id="user-area" class="ms-3"></span>
    </nav>
  </div>
</header>

<section class="favoritos-hero">
  <div class="container text-center">
    <h1 class="display-4 mb-3">
      Meus favoritos
    </h1>
    <p class="lead" id="contador-favoritos">Carregando...</p>
  </div>
</section>

<main>
  <section class="container py-5">
    
    <!-- Estado vazio -->
    <div id="empty-state" class="empty-state" style="display: none;">
      <i class="bi bi-heart"></i>
      <h3>Nenhum favorito ainda</h3>
      <p class="text-muted mb-4">Comece a explorar e adicione lugares incríveis aos seus favoritos!</p>
      <a href="index.html" class="btn btn-primary btn-lg">
        <i class="bi bi-compass"></i> Explorar Lugares
      </a>
    </div>

    <!-- Lista de favoritos -->
    <div id="lista-favoritos" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <!-- Cards serão carregados aqui -->
    </div>

  </section>
</main>

<footer id="contato" class="bg-dark text-white py-5">
  <div class="container text-center">
    <small>Guia BH & Região | LSF </small>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="assets/scripts/auth.js"></script>
<script src="assets/scripts/favoritos.js"></script>
<script>
// Script específico da página de favoritos
document.addEventListener('DOMContentLoaded', function() {
  const usuario = JSON.parse(localStorage.getItem('usuarioLogado'));
  
  // Verificar se está logado
  if (!usuario) {
    alert('Você precisa estar logado para ver seus favoritos!');
    window.location.href = 'login.html';
    return;
  }
  
  carregarFavoritos();
});

function carregarFavoritos() {
  const favoritos = obterFavoritos();
  const listaFavoritos = document.getElementById('lista-favoritos');
  const emptyState = document.getElementById('empty-state');
  const contador = document.getElementById('contador-favoritos');
  
  // Atualizar contador
  contador.textContent = favoritos.length === 0 
    ? 'Você ainda não tem favoritos' 
    : `Você tem ${favoritos.length} ${favoritos.length === 1 ? 'favorito' : 'favoritos'}`;
  
  if (favoritos.length === 0) {
    listaFavoritos.style.display = 'none';
    emptyState.style.display = 'block';
    return;
  }
  
  listaFavoritos.style.display = 'flex';
  emptyState.style.display = 'none';
  
  // Ordenar por data (mais recentes primeiro)
  favoritos.sort((a, b) => new Date(b.dataAdicionado) - new Date(a.dataAdicionado));
  
  // Renderizar cards
  listaFavoritos.innerHTML = favoritos.map(local => `
    <div class="col">
      <div class="card card-favorito h-100 position-relative">
        <button class="btn btn-danger btn-sm btn-remover" onclick="removerERecarregar(${local.id})" title="Remover dos favoritos">
          <i class="bi bi-heart-fill"></i>
        </button>
        
        <img src="${local.imagem || 'https://via.placeholder.com/400x250?text=Sem+Imagem'}" 
             class="card-img-top" 
             alt="${local.nome}"
             style="height: 200px; object-fit: cover;">
        
        <div class="card-body">
          <h5 class="card-title">${local.nome}</h5>
          
          <div class="mb-2">
            <span class="badge bg-primary">${local.categoria || 'Sem categoria'}</span>
            ${local.tipo ? `<span class="badge bg-secondary">${local.tipo}</span>` : ''}
          </div>
          
          <p class="card-text text-muted small">
            <i class="bi bi-geo-alt-fill"></i> ${local.endereco || 'Endereço não informado'}
          </p>
          
          ${local.descricao ? `<p class="card-text small">${local.descricao.substring(0, 100)}...</p>` : ''}
          
          <div class="d-flex justify-content-between align-items-center mt-3">
            <small class="text-muted">
              <i class="bi bi-calendar-plus"></i> 
              ${new Date(local.dataAdicionado).toLocaleDateString('pt-BR')}
            </small>
            <div class="rating">
              ${gerarEstrelas(local.avaliacao || 0)}
            </div>
          </div>
        </div>
        
        <div class="card-footer bg-white">
          <a href="detalhes.html?id=${local.id}" class="btn btn-outline-primary btn-sm w-100">
            <i class="bi bi-eye"></i> Ver Detalhes
          </a>
        </div>
      </div>
    </div>
  `).join('');
}

function gerarEstrelas(avaliacao) {
  const estrelas = Math.round(avaliacao);
  let html = '';
  
  for (let i = 1; i <= 5; i++) {
    if (i <= estrelas) {
      html += '<i class="bi bi-star-fill text-warning"></i>';
    } else {
      html += '<i class="bi bi-star text-warning"></i>';
    }
  }
  
  return html;
}

function removerERecarregar(localId) {
  if (removerFavorito(localId)) {
    carregarFavoritos();
    atualizarContadorFavoritos();
  }
}
</script>
</body>
</html>